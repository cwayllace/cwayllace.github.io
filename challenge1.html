<!DOCTYPE html>
<html>
    <head>
        <title>Challenge 1: Build the Map</title>
        <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&family=Libre+Baskerville&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style1.css">
    </head>
    <body>
        <h1>Challenge 1: The Crossroads of Ancient Cities</h1>
        <p>Your first task is to navigate a small, but vital, part of the Maya network. Ixchel starts her journey in **Palenque** and believes the crystal jaguar statue is hidden in **Uxmal**. Reconstruct the map below based on the following connections:</p>
        <ul>
            <li>**Palenque** is connected to **Copan**, **Chichen Itza**, and **Tikal**.</li>
            <li>**Chichen Itza** is connected to **Copan**, **Tikal**, and **Palenque**.</li>
            <li>**Tikal** is connected to **Uxmal**, **Chichen Itza**, and **Palenque**.</li>
            <li>**Copan** is connected to **Chichen Itza**, **Palenque**, and **Uxmal**.</li>
            <li>**Uxmal** is only connected to **Tikal** and **Copan**.</li>
        </ul>

        <div id="validation-section">
            <form id="challenge-form">
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Tikal</th>
                            <th>Palenque</th>
                            <th>Chichen Itza</th>
                            <th>Copan</th>
                            <th>Uxmal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>Tikal</th>
                            <td>-</td>
                            <td><input type="checkbox" id="cell-0-1"></td>
                            <td><input type="checkbox" id="cell-0-2"></td>
                            <td><input type="checkbox" id="cell-0-3"></td>
                            <td><input type="checkbox" id="cell-0-4"></td>
                        </tr>
                        <tr>
                            <th>Palenque</th>
                            <td><input type="checkbox" id="cell-1-0"></td>
                            <td>-</td>
                            <td><input type="checkbox" id="cell-1-2"></td>
                            <td><input type="checkbox" id="cell-1-3"></td>
                            <td><input type="checkbox" id="cell-1-4"></td>
                        </tr>
                        <tr>
                            <th>Chichen Itza</th>
                            <td><input type="checkbox" id="cell-2-0"></td>
                            <td><input type="checkbox" id="cell-2-1"></td>
                            <td>-</td>
                            <td><input type="checkbox" id="cell-2-3"></td>
                            <td><input type="checkbox" id="cell-2-4"></td>
                        </tr>
                        <tr>
                            <th>Copan</th>
                            <td><input type="checkbox" id="cell-3-0"></td>
                            <td><input type="checkbox" id="cell-3-1"></td>
                            <td><input type="checkbox" id="cell-3-2"></td>
                            <td>-</td>
                            <td><input type="checkbox" id="cell-3-4"></td>
                        </tr>
                        <tr>
                            <th>Uxmal</th>
                            <td><input type="checkbox" id="cell-4-0"></td>
                            <td><input type="checkbox" id="cell-4-1"></td>
                            <td><input type="checkbox" id="cell-4-2"></td>
                            <td><input type="checkbox" id="cell-4-3"></td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
                <div class="controls">
                    <button type="submit" class="start-button">Check My Map</button>
                </div>
            </form>
            <p id="feedback" style="font-weight: bold; margin-top: 10px;"></p>
        </div>

        <script src="graph.js"></script>
        <script>
            // Define the correct matrix for Challenge 1
            const correctMatrix = [
                //   T P C O U
                [0, 1, 1, 0, 1], // 0: Tikal (P, C, U)
                [1, 0, 1, 1, 0], // 1: Palenque (T, C, O)
                [1, 1, 0, 1, 0], // 2: Chichen Itza (T, P, O)
                [0, 1, 1, 0, 1], // 3: Copan (P, C, U)
                [1, 0, 0, 1, 0]  // 4: Uxmal (T, O)
            ];

            document.getElementById('challenge-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const userMatrix = saveMatrixFromForm(5);
                const feedback = document.getElementById('feedback');

                const isCorrect = JSON.stringify(userMatrix) === JSON.stringify(correctMatrix);

                if (isCorrect) {
                    feedback.textContent = "✅ Your map is correct! You're ready to explore.";
                    feedback.style.color = "green";
                    
                    // Set the correct start and goal nodes for this challenge
                    localStorage.setItem('adjacencyMatrix', JSON.stringify(userMatrix));
                    localStorage.setItem('startNode', '1'); // Palenque
                    localStorage.setItem('goalNode', '4');  // Uxmal
                    
                    // Add a button to proceed to the visualization
                    document.getElementById('validation-section').innerHTML += '<a href="visualization.html"><button class="start-button" style="margin-top: 20px;">Start Exploration</button></a>';
                } else {
                    feedback.textContent = "❌ Your map is incorrect. Please check the connections and try again!";
                    feedback.style.color = "red";
                }
            });

            // Sync matrix checkboxes
            const cells = document.querySelectorAll('input[type="checkbox"]');
            cells.forEach(cell => {
                cell.addEventListener('change', (e) => {
                    const id = e.target.id;
                    const [row, col] = id.replace('cell-', '').split('-').map(Number);
                    const oppositeCell = document.getElementById(`cell-${col}-${row}`);
                    if (oppositeCell) {
                        oppositeCell.checked = e.target.checked;
                    }
                });
            });
        </script>
    </body>
</html>